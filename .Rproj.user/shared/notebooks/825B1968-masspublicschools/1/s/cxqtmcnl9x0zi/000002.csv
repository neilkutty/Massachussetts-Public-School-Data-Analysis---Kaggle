"0","# ********************************************************************************"
"0","# -  -  - Prepare Correlation Data Function -------------------------------------- #"
"0","# ********************************************************************************"
"0","prep_corr_data = function(x){"
"0","    "
"0","    #The first step is to filter for only highschools and "
"0","    #  get rid of features related to 'MCAS'"
"0","    hs2 = x[x$X12_Enrollment > 0, -grep(""MCAS"",colnames(x))]"
"0","    #Next the numeric columns in the dataset are identified"
"0","    nums <- sapply(hs2, is.numeric)"
"0","    #Select the columns from the original to merge to the numeric only data"
"0","    to_merge <- hs2[,colnames(hs2) %in% c('School.Name','School.Code')]"
"0","    #Pull out all records that are numeric only"
"0","    hs_corr_data <- hs2[,nums]    "
"0","    #Merge the to_merge and hs_corr_data dataframes"
"0","    corrdat = merge(to_merge,hs_corr_data)"
"0","    "
"0","    #Now it's time to clean the column names. First we put all"
"0","    #  of the column names in it's own dataframe. This makes it"
"0","    #  possible to deal with the names as we would values of a"
"0","    #  column / feature.  We then make all the names lowercase"
"0","    #  and remove spacing characters as well as abbreviate where"
"0","    #  possible. Finally we store the new cleaned column names"
"0","    #  in a list.  "
"0","    cornames = as.data.frame(colnames(corrdat))"
"0","    colnames(cornames) = 'names'"
"0","    cornames$new = tolower(gsub('X\\..','x_',cornames$names))"
"0","    cornames$new2 = gsub('\\.','_',cornames$new)"
"0","    cornames$new3 = gsub('progress_and_performance_index__ppi____',"
"0","                         'ppi_',cornames$new2)"
"0","    cornames$new4 = gsub('____','',cornames$new3)"
"0","    newnames = as.list(cornames$new4)"
"0","    "
"0","    #Assign the new column names to the columns in the dataframe"
"0","    colnames(corrdat) = newnames"
"0","    #Use the labels brought over in the merge (School Name) as rownames"
"0","    rownames(corrdat) = corrdat$school_name"
"0","    #Remove unneeded columns that are numeric as well as the school id labels"
"0","    # we originally retained in the merge above. "
"0","    corrdat = corrdat[,!names(corrdat) %in% c('school_name','school_code',"
"0","                                              'district_code','zip','x1_enrollment',"
"0","                                              'x2_enrollment','x3_enrollment',"
"0","                                              'x4_enrollment','x5_enrollment',"
"0","                                              'x6_enrollment','x7_enrollment',"
"0","                                              'x8_enrollment','total___of_classes',"
"0","                                              'ap_five_or_more_tests',"
"0","                                              'ap_four_tests','ap_three_tests',"
"0","                                              'ap_two_tests','ap_one_test')]"
"0","    "
"0","    #Finally remove any records that have at least one null value.   "
"0","    corrdat = na.omit(corrdat)"
"0","    return(corrdat)"
"0","}"
"0","# ********************************************************************************"
"0","# -  -  - END - Prepare Correlation Data Function --------------------------------- #"
"0","# ********************************************************************************"
